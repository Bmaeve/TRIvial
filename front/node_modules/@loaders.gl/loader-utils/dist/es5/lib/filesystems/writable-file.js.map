{"version":3,"file":"writable-file.js","names":["makeWritableFile","pathOrStream","options","isBrowser","write","close","outputStream","fs","createWriteStream","buffer","Promise","resolve","reject","err"],"sources":["../../../../src/lib/filesystems/writable-file.ts"],"sourcesContent":["// Forked from https://github.com/kbajalc/parquets under MIT license (Copyright (c) 2017 ironSource Ltd.)\nimport {isBrowser} from '@loaders.gl/loader-utils';\nimport * as fs from '../node/fs';\nimport type {Writable} from 'stream';\n\nexport type WritableFile = {\n  write: (buf: Buffer) => Promise<void>;\n  close: () => Promise<void>;\n};\n\nexport interface WriteStreamOptions {\n  flags?: string;\n  encoding?: 'utf8';\n  fd?: number;\n  mode?: number;\n  autoClose?: boolean;\n  start?: number;\n}\n\n/** Helper function to create an envelope reader for a binary memory input */\nexport function makeWritableFile(\n  pathOrStream: string | Writable,\n  options?: WriteStreamOptions\n): WritableFile {\n  if (isBrowser) {\n    return {\n      write: async () => {},\n      close: async () => {}\n    };\n  }\n\n  const outputStream: Writable =\n    typeof pathOrStream === 'string' ? fs.createWriteStream(pathOrStream, options) : pathOrStream;\n  return {\n    write: async (buffer: Buffer) =>\n      new Promise((resolve, reject) => {\n        outputStream.write(buffer, (err) => (err ? reject(err) : resolve()));\n      }),\n    close: () =>\n      new Promise((resolve, reject) => {\n        (outputStream as any).close((err) => (err ? reject(err) : resolve()));\n      })\n  };\n}\n"],"mappings":";;;;;;;;;;AACA;AACA;AAAiC;AAAA;;AAkB1B,SAASA,gBAAgB,CAC9BC,YAA+B,EAC/BC,OAA4B,EACd;EACd,IAAIC,sBAAS,EAAE;IACb,OAAO;MACLC,KAAK;QAAA,uEAAE;UAAA;YAAA;cAAA;gBAAA;gBAAA;kBAAA;cAAA;YAAA;UAAA;QAAA,CAAc;QAAA;UAAA;QAAA;QAAA;MAAA;MACrBC,KAAK;QAAA,uEAAE;UAAA;YAAA;cAAA;gBAAA;gBAAA;kBAAA;cAAA;YAAA;UAAA;QAAA,CAAc;QAAA;UAAA;QAAA;QAAA;MAAA;IACvB,CAAC;EACH;EAEA,IAAMC,YAAsB,GAC1B,OAAOL,YAAY,KAAK,QAAQ,GAAGM,EAAE,CAACC,iBAAiB,CAACP,YAAY,EAAEC,OAAO,CAAC,GAAGD,YAAY;EAC/F,OAAO;IACLG,KAAK;MAAA,wEAAE,kBAAOK,MAAc;QAAA;UAAA;YAAA;cAAA;gBAAA,kCAC1B,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;kBAC/BN,YAAY,CAACF,KAAK,CAACK,MAAM,EAAE,UAACI,GAAG;oBAAA,OAAMA,GAAG,GAAGD,MAAM,CAACC,GAAG,CAAC,GAAGF,OAAO,EAAE;kBAAA,CAAC,CAAC;gBACtE,CAAC,CAAC;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;MAAA;QAAA;MAAA;MAAA;IAAA;IACJN,KAAK,EAAE;MAAA,OACL,IAAIK,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;QAC9BN,YAAY,CAASD,KAAK,CAAC,UAACQ,GAAG;UAAA,OAAMA,GAAG,GAAGD,MAAM,CAACC,GAAG,CAAC,GAAGF,OAAO,EAAE;QAAA,CAAC,CAAC;MACvE,CAAC,CAAC;IAAA;EACN,CAAC;AACH"}