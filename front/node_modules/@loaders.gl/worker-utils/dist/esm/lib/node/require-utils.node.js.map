{"version":3,"file":"require-utils.node.js","names":["Module","path","requireFromFile","filename","startsWith","response","fetch","code","text","requireFromString","process","cwd","require","options","Error","paths","_nodeModulePaths","dirname","parent","module","newModule","concat","prependPaths","appendPaths","_compile","children","splice","indexOf","exports"],"sources":["../../../../src/lib/node/require-utils.node.ts"],"sourcesContent":["// Fork of https://github.com/floatdrop/require-from-string/blob/master/index.js\n// Copyright (c) Vsevolod Strukchinsky <floatdrop@gmail.com> (github.com/floatdrop)\n// MIT license\n\n// this file is not visible to webpack (it is excluded in the package.json \"browser\" field).\n\nimport Module from 'module';\nimport path from 'path';\n\n// Node.js Dynamically require from file\n// Relative names are resolved relative to cwd\n// This indirect function is provided because webpack will try to bundle `module.require`.\n// this file is not visible to webpack (it is excluded in the package.json \"browser\" field).\nexport async function requireFromFile(filename: string): Promise<any> {\n  if (filename.startsWith('http')) {\n    const response = await fetch(filename);\n    const code = await response.text();\n    return requireFromString(code);\n  }\n\n  if (!filename.startsWith('/')) {\n    filename = `${process.cwd()}/${filename}`;\n  }\n  return require(filename);\n}\n\n// Dynamically require from string\n// - `code` - Required - Type: string - Module code.\n// - `filename` - Type: string - Default: '' - Optional filename.\n// - `options.appendPaths` Type: Array List of paths, that will be appended to module paths.\n// Useful, when you want to be able require modules from these paths.\n// - `options.prependPaths` Type: Array Same as appendPaths, but paths will be prepended.\nexport function requireFromString(\n  code: string,\n  filename = '',\n  options?: {\n    prependPaths?: string[];\n    appendPaths?: string[];\n  }\n): any {\n  if (typeof filename === 'object') {\n    options = filename;\n    filename = '';\n  }\n\n  if (typeof code !== 'string') {\n    throw new Error(`code must be a string, not ${typeof code}`);\n  }\n\n  // @ts-ignore\n  const paths = Module._nodeModulePaths(path.dirname(filename));\n\n  const parent = module.parent;\n  // @ts-ignore\n  const newModule = new Module(filename, parent);\n  newModule.filename = filename;\n  newModule.paths = ([] as string[])\n    .concat(options?.prependPaths || [])\n    .concat(paths)\n    .concat(options?.appendPaths || []);\n  // @ts-ignore\n  newModule._compile(code, filename);\n\n  if (parent && parent.children) {\n    parent.children.splice(parent.children.indexOf(newModule), 1);\n  }\n\n  return newModule.exports;\n}\n"],"mappings":";;AAMA,OAAOA,MAAM,MAAM,QAAQ;AAC3B,OAAOC,IAAI,MAAM,MAAM;;AAMvB,OAAO,eAAeC,eAAe,CAACC,QAAgB,EAAgB;EACpE,IAAIA,QAAQ,CAACC,UAAU,CAAC,MAAM,CAAC,EAAE;IAC/B,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAACH,QAAQ,CAAC;IACtC,MAAMI,IAAI,GAAG,MAAMF,QAAQ,CAACG,IAAI,EAAE;IAClC,OAAOC,iBAAiB,CAACF,IAAI,CAAC;EAChC;EAEA,IAAI,CAACJ,QAAQ,CAACC,UAAU,CAAC,GAAG,CAAC,EAAE;IAC7BD,QAAQ,aAAMO,OAAO,CAACC,GAAG,EAAE,cAAIR,QAAQ,CAAE;EAC3C;EACA,OAAOS,OAAO,CAACT,QAAQ,CAAC;AAC1B;;AAQA,OAAO,SAASM,iBAAiB,CAC/BF,IAAY,EAMP;EAAA;EAAA,IALLJ,QAAQ,uEAAG,EAAE;EAAA,IACbU,OAGC;EAED,IAAI,OAAOV,QAAQ,KAAK,QAAQ,EAAE;IAChCU,OAAO,GAAGV,QAAQ;IAClBA,QAAQ,GAAG,EAAE;EACf;EAEA,IAAI,OAAOI,IAAI,KAAK,QAAQ,EAAE;IAC5B,MAAM,IAAIO,KAAK,sCAA+B,OAAOP,IAAI,EAAG;EAC9D;;EAGA,MAAMQ,KAAK,GAAGf,MAAM,CAACgB,gBAAgB,CAACf,IAAI,CAACgB,OAAO,CAACd,QAAQ,CAAC,CAAC;EAE7D,MAAMe,MAAM,GAAGC,MAAM,CAACD,MAAM;EAE5B,MAAME,SAAS,GAAG,IAAIpB,MAAM,CAACG,QAAQ,EAAEe,MAAM,CAAC;EAC9CE,SAAS,CAACjB,QAAQ,GAAGA,QAAQ;EAC7BiB,SAAS,CAACL,KAAK,GAAI,EAAE,CAClBM,MAAM,CAAC,aAAAR,OAAO,6CAAP,SAASS,YAAY,KAAI,EAAE,CAAC,CACnCD,MAAM,CAACN,KAAK,CAAC,CACbM,MAAM,CAAC,cAAAR,OAAO,8CAAP,UAASU,WAAW,KAAI,EAAE,CAAC;EAErCH,SAAS,CAACI,QAAQ,CAACjB,IAAI,EAAEJ,QAAQ,CAAC;EAElC,IAAIe,MAAM,IAAIA,MAAM,CAACO,QAAQ,EAAE;IAC7BP,MAAM,CAACO,QAAQ,CAACC,MAAM,CAACR,MAAM,CAACO,QAAQ,CAACE,OAAO,CAACP,SAAS,CAAC,EAAE,CAAC,CAAC;EAC/D;EAEA,OAAOA,SAAS,CAACQ,OAAO;AAC1B"}